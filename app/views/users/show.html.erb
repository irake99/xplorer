
<div class="container">
  <div class="row">
    <div class="col-md-12 col-lg-12">
      <div class="well profile custom-well row">
        <div class="col-sm-12">
          <div class="col-xs-12 col-sm-4 text-center">
            <figure>
              <% if @user.avatar? %>
                <%= image_tag @user.avatar.url, width: '100%' %>
              <% end %>
            </figure>
          </div>
          <div class="col-xs-12 col-sm-8">
              <h2>
                <%= @user.name %>
                <% if current_user %>
                  <% if @user == current_user %>
                    <%= link_to('修改個人檔案', edit_user_path(@user), class: "btn btn-default") %>
                    <% elsif current_user.following?(@user) %>
                      <%= link_to '取消追蹤', user_followship_path(@user), method: :delete, class: "btn btn-danger" %>
                    <% else %>
                      <%= link_to '追蹤', user_followships_path(following_id: @user), method: :post, class: "btn btn-primary" %>
                  <% end %>
                  <% else %>
                    <%= link_to '追蹤', user_followships_path(following_id: @user), method: :post, class: "btn btn-primary" %>
                <% end %>
              </h2>
              <p><strong>電子郵件: </strong>
                <% if @user == current_user %>
                  <%= @user.email %>
                  <% if @user.contact_privacy %> 
                    <%= button_to "郵件公開", user_path(@user), method: :patch, params: { :"user[contact_privacy]" => false }, class: "btn btn-primary btn-xs" %>
                  <% else %>
                    <%= button_to "郵件不公開", user_path(@user), method: :patch, params: { :"user[contact_privacy]" => true }, class: "btn btn-primary btn-xs" %>
                  <% end %>
                <!-- 非本人當使用者設定可以看到Email時，顯示Email -->
                <% elsif @user.contact_privacy %>
                  <%= @user.email %>
                <!-- 非本人當使用者設定不可以看到Email時，顯示使用者不公開 -->
                <% else %>
                  使用者不公開
                <% end %>
                <br> 
             </p>
              <p><strong>簡介: </strong><%= @user.introduction %></p>
              <p><strong>技能: </strong>
                  <% @user.skill_list.each do |skill| %>
                    <span class="label label-success"><%= skill %></span>
                  <% end %>
              </p>
          </div>    
        </div>
        <div class="col-xs-12 divider text-center">
          <hr>
          <div class="col-xs-12 col-sm-4 col-lg-2 emphasis">
            <h4><span class="glyphicon glyphicon-user" aria-hidden="true"></span> 追隨者</h4>
            <h4><strong> <%= @user.followings_count %> </strong></h4>
          </div>
          <div class="col-xs-12 col-sm-4 col-lg-2 emphasis">
            <h4><span class="glyphicon glyphicon-file" aria-hidden="true"></span> 議題數</h4>
            <h4><strong> <%= @posted_issues.size %> </strong></h4>
          </div>
          <div class="col-xs-12 col-sm-4 col-lg-2 emphasis">
            <h4><span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span> 瀏覽數</h4>
            <h4><strong> <%= @views_total %> </strong></h4>
          </div>
          <div class="col-xs-12 col-sm-4 col-lg-2 emphasis">
            <h4><span class="glyphicon glyphicon-heart" aria-hidden="true"></span> 讚數</h4>
            <h4><strong> <%= @likes_total %> </strong></h4>
          </div>
          <div class="col-xs-12 col-sm-4 col-lg-2 emphasis">      
            <h4><span class="glyphicon glyphicon-share" aria-hidden="true"></span> 分享數</h4>
            <h4><strong>43</strong></h4>       
          </div>
          <div class="col-xs-12 col-sm-4 col-lg-2 emphasis">
            <h4><span class="glyphicon glyphicon-bookmark" aria-hidden="true"></span> 收藏數</h4>
            <h4><strong>43</strong></h4>
          </div>
        </div>
      </div>                 
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <div data-spy="scroll" class="tabbable-panel">
      <div class="tabbable-line">
        <ul class="nav nav-tabs ">
          <li class="active">
            <a href="#tab_default_1" data-toggle="tab">
            已發布議題 </a>
          </li>
          <li>
            <a href="#tab_default_2" data-toggle="tab">
           使用紀錄</a>
          </li>
          <li>
            <a href="#tab_default_3" data-toggle="tab">
           追蹤者 (<%= @user.followers_count %>)</a>
          </li>
          <li>
            <a href="#tab_default_4" data-toggle="tab">
           追隨者</a>
          </li>
          <li>
            <a href="#tab_default_5" data-toggle="tab">
           X Map</a>
          </li>
          <li>
            <a href="#tab_default_5" data-toggle="tab">
           草稿</a>
          </li>
        </ul>
        <div class="tab-content">
          <div class="tab-pane active" id="tab_default_1">
            <!-- 議題文繞圖 -->
            <div class="container">
              <% @posted_issues.each do |posted_issue| %>
                <%= render :partial => 'topics/brief_issue', locals: { issue: posted_issue } %>
              <% end %>
            </div>
          </div>
          <div class="tab-pane" id="tab_default_2">
            <p>
              Education& Career
            </p>
            <div class="row">
            <div class="col-sm-6">
              <div class="form-group">
                   <label for="email">Highest Education:</label>
                    <p> MBA/PGDM</p>
               </div>
                <div class="form-group">
                   <label for="email">Place of Birth:</label>
                    <p> pune, maharashtra</p>
               </div>
                <div class="form-group">
                   <label for="email">Place of Birth:</label>
                    <p> pune, maharashtra</p>
               </div>
                <div class="form-group">
                   <label for="email">Place of Birth:</label>
                    <p> pune, maharashtra</p>
               </div>
            </div>
            <div class="col-sm-6">
               <div class="form-group">
                   <label for="email">Place of Birth:</label>
                    <p> pune, maharashtra</p>
               </div>
                <div class="form-group">
                   <label for="email">Place of Birth:</label>
                    <p> pune, maharashtra</p>
               </div>
                <div class="form-group">
                   <label for="email">Place of Birth:</label>
                    <p> pune, maharashtra</p>
               </div>
                <div class="form-group">
                   <label for="email">Place of Birth:</label>
                    <p> pune, maharashtra</p>
               </div>

             </div>
            </div>
          </div>
          <div class="tab-pane" id="tab_default_3">
            <p>
              Family Details
            </p>
            <div class="row">
            <div class="col-sm-6">
              <div class="form-group">
                   <label for="email">Highest Education:</label>
                    <p> MBA/PGDM</p>
               </div>
                <div class="form-group">
                   <label for="email">Place of Birth:</label>
                    <p> pune, maharashtra</p>
               </div>
                <div class="form-group">
                   <label for="email">Place of Birth:</label>
                    <p> pune, maharashtra</p>
               </div>
                <div class="form-group">
                   <label for="email">Place of Birth:</label>
                    <p> pune, maharashtra</p>
               </div>
            </div>
            <div class="col-sm-6">
               <div class="form-group">
                   <label for="email">Place of Birth:</label>
                    <p> pune, maharashtra</p>
               </div>
                <div class="form-group">
                   <label for="email">Place of Birth:</label>
                    <p> pune, maharashtra</p>
               </div>
                <div class="form-group">
                   <label for="email">Place of Birth:</label>
                    <p> pune, maharashtra</p>
               </div>
                <div class="form-group">
                   <label for="email">Place of Birth:</label>
                    <p> pune, maharashtra</p>
               </div>

             </div>
            </div>
          </div>
           <div class="tab-pane" id="tab_default_4">
            <p>
             Lifestyle

            </p>
             <div class="row">
            <div class="col-sm-6">
              <div class="form-group">
                   <label for="email">Highest Education:</label>
                    <p> MBA/PGDM</p>
               </div>
                <div class="form-group">
                   <label for="email">Place of Birth:</label>
                    <p> pune, maharashtra</p>
               </div>
                <div class="form-group">
                   <label for="email">Place of Birth:</label>
                    <p> pune, maharashtra</p>
               </div>
                <div class="form-group">
                   <label for="email">Place of Birth:</label>
                    <p> pune, maharashtra</p>
               </div>
            </div>
            <div class="col-sm-6">
               <div class="form-group">
                   <label for="email">Place of Birth:</label>
                    <p> pune, maharashtra</p>
               </div>
                <div class="form-group">
                   <label for="email">Place of Birth:</label>
                    <p> pune, maharashtra</p>
               </div>
                <div class="form-group">
                   <label for="email">Place of Birth:</label>
                    <p> pune, maharashtra</p>
               </div>
                <div class="form-group">
                   <label for="email">Place of Birth:</label>
                    <p> pune, maharashtra</p>
               </div>

             </div>
            </div>
          </div>
        </div>
      </div>
    
    </div>
  </div>

<!-- 原始測試資料 -->
<hr>
<p>----------------------- 原始測試資料 -----------------------</p>

<h2>Personal Xmap:</h2>
<svg></svg>
<script>
  var width = 960;
  var height = 600;
  var svg = d3.select("svg").attr("width", width).attr("height", height)
  var topics = <%= raw(@map_topics.to_json) %>
  var links  = <%= raw(@map_links.to_json) %>
  xmap(svg, topics, links, width, height);
</script>
<br>
<% if @user == current_user %>
  <%= link_to('修改個人檔案', edit_user_path(@user)) %>
  <br>
<% end %>  

Avatar:
<br>
<% if @user.avatar? %>
  <%= image_tag @user.avatar.url, width: '300px' %>
<% end %>
<br>

Name:
<%= @user.name %>
<br>

Email:
<!-- 使用者可以看到自己的Email和決定是否要公開 -->
<% if @user == current_user %>
  <%= @user.email %>
  <% if @user.contact_privacy %> 
    <%= button_to "改為不公開", user_path(@user), method: :patch, params: { :"user[contact_privacy]" => false }, class: "btn btn-info" %>
  <% else %>
    <%= button_to "改為公開", user_path(@user), method: :patch, params: { :"user[contact_privacy]" => true }, class: "btn btn-primary" %>
  <% end %>
<!-- 非本人當使用者設定可以看到Email時，顯示Email -->
<% elsif @user.contact_privacy %>
  <%= @user.email %>
<!-- 非本人當使用者設定不可以看到Email時，顯示使用者不公開 -->
<% else %>
  使用者不公開
<% end %>
<br>

Introduction:
<%= @user.introduction %>
<br>

Skill:
<% @user.skill_list.each do |skill| %>
  <li><%= skill %></li>
<% end %>
<br>

<!-- 個人成就資料 -->
追隨者人數：
<%= @user.followers_count %>
<br>
追蹤的人數：
<%= @user.followings_count %>
<br>
發布議題數量：
<%= @posted_issues.size %>
<br>
發布議題總like數：
<%= @likes_total %>
<br>
發布議題總瀏覽數：
<%= @views_total %>
<br>

<!-- 追蹤／取消追蹤 -->
追隨者清單：
<%= render partial: "follow_list", locals: {users: @followers} %>
<br>
追蹤清單：
<%= render partial: "follow_list", locals: {users: @followings} %>
追蹤使用者：
<br>

<% if current_user %>
  <% if @user == current_user %>
    <%= link_to '追蹤', user_followships_path(following_id: @user), method: :post, class: "btn btn-primary disabled" %>
  <% elsif current_user.following?(@user) %>
    <%= link_to '取消追蹤', user_followship_path(@user), method: :delete, class: "btn btn-danger" %>
  <% else %>
    <%= link_to '追蹤', user_followships_path(following_id: @user), method: :post, class: "btn btn-primary" %>
  <% end %>
<% else %>
  <%= link_to '追蹤', user_followships_path(following_id: @user), method: :post, class: "btn btn-primary" %>
<% end %>
<br>

My X Map:
<!-- 使用者可以看到自己的X MAP和決定是否要公開 -->
<% if @user == current_user %>
  For test(X MAP)
  <% if @user.topic_follow_privacy %> 
    <%= button_to "改為不公開", user_path(@user), method: :patch, params: { :"user[topic_follow_privacy]" => false }, class: "btn btn-info" %>
  <% else %>
    <%= button_to "改為公開", user_path(@user), method: :patch, params: { :"user[topic_follow_privacy]" => true }, class: "btn btn-primary" %>
  <% end %>
<!-- 非本人當使用者設定可以看到X MAP時，顯示X MAP -->
<% elsif @user.topic_follow_privacy %>
  For test(X MAP)
<!-- 非本人當使用者設定不可以看到X MAP時，顯示使用者不公開 -->
<% else %>
  使用者不公開
<% end %>
<br>

My Personal Issue:
<%= render partial: "issue_list", locals: {issues: @posted_issues} %>
<!-- 草稿只有自己看得到 -->
<% if @user == current_user %>
  <%= render partial: "issue_list", locals: {issues: @unposted_issues} %>
<% end %>

My Bookmark Issue:
<!-- 使用者可以看到自己的Bookmark和決定是否要公開 -->
<% if @user == current_user %>
  <%= render partial: "issue_list", locals: {issues: @marked_issues} %>
  <% if @user.issue_book_privacy %> 
    <%= button_to "改為不公開", user_path(@user), method: :patch, params: { :"user[issue_book_privacy]" => false }, class: "btn btn-info" %>
  <% else %>
    <%= button_to "改為公開", user_path(@user), method: :patch, params: { :"user[issue_book_privacy]" => true }, class: "btn btn-primary" %>
  <% end %>
<!-- 非本人當使用者設定可以看到Bookmark時，顯示Bookmark -->
<% elsif @user.issue_book_privacy %>
  <%= render partial: "issue_list", locals: {issues: @marked_issues} %>
<!-- 非本人當使用者設定不可以看到Bookmark時，顯示使用者不公開 -->
<% else %>
  使用者不公開
<% end %>
<br>

My Commented Issue:
<%= render partial: "issue_list", locals: {issues: @commented_issues} %>


    
